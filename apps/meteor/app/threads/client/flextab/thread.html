<template name="thread">
	<section class="contextual-bar__content flex-tab threads dropzone {{dragAndDrop}} {{hideUsername}}">
		<div class="dropzone-overlay {{isDropzoneDisabled}} background-transparent-darkest color-content-background-color">{{_ dragAndDropLabel}}</div>
		<div class="thread-list js-scroll-thread">
			<ul class="thread">
				{{# with messageContext}}
					{{#if isLoading}}
						<li class="load-more">
							{{> loading}}
						</li>
					{{else}}
						{{# if $eq (preference 'enableNewMessageTemplate') true}}
								{{> ThreadMessageList rid=rid tmid=tmid }}
						{{/if}}
						{{# unless $eq (preference 'enableNewMessageTemplate') true}}
							{{> message groupable=false hideRoles=true msg=mainMessage room=room subscription=subscription settings=settings customClass="thread-message" templatePrefix='thread-' customClass="thread-main" u=u ignored=false shouldCollapseReplies=true}}
							{{#each msg in messages}}
								{{> message hideRoles=true msg=msg room=room shouldCollapseReplies=true subscription=subscription settings=settings templatePrefix='thread-' u=u context="threads"}}
							{{/each}}
						{{/unless}}
					{{/if}}
				{{/with}}
			</ul>
		</div>
		{{> messageBox messageBoxData}}
	</section>
</template>
